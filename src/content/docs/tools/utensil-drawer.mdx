---
title: The Utensil Drawer
description: "Pull out just the tools you need to craft polished transitions."
head:
  - tag: meta
    attrs:
      property: "og:image"
      content: "/drawer-og.png"
---
import { Steps } from "@astrojs/starlight/components";
import Logo from "@/components/Logo.astro";
import drawer from "@/assets/drawer.png";
import UtensilGrid from "@/components/UtensilGrid.astro"
import Utensil from "@/components/Utensil.astro"
import Media from "@/components/Media.astro"

<Logo alt="The Utensil Drawer" image={drawer}>
Pull out just the tools you need to craft polished transitions.

The Utensil Drawer is a collection of functions that might come in handy when programming view transitions.

 Some functions are meant to be imported into your own scripts, while others can be used directly as scripts on websites. For the latter, the Utensil Drawer also provides bundled, ready-to-use versions.

</Logo>


## What is it?

This will be an eclectic collection of snippets for various purposes. Preliminary versions of the `@vtbag/utensil-drawer` package are currently available on npm, but it is not fully supported yet.


<UtensilGrid>
<Utensil title="Type Declarations" description="A temporary solution until Definitively Typed is ready and the Level 2 definitions are available." href="#type-declarations"/>
<Utensil title="Declarative Names" description="Use CSS selectors to assign view transition names to HTML elements." href="#declarative-names"/>
</UtensilGrid>


## Type Declarations

Copy `src/dom-view-transitions-level2.d.ts` to your `src` directory if you are missing declarations for the new types and interfaces.

```ts
declare global {
	interface PageSwapEvent extends Event {
		viewTransition: ViewTransition;
		activation: NavigationActivation;
	}

	type UpdateCallback = undefined | (() => void | Promise<void>);
	type StartViewTransitionParameter = { types?: string[] | Set<string>; update?: UpdateCallback };

	interface Document {
		startViewTransition(param?: StartViewTransitionParameter | UpdateCallback): ViewTransition;
	}
	interface PageRevealEvent extends Event {
		viewTransition: ViewTransition;
	}

	interface WindowEventMap {
		pageswap: PageSwapEvent;
		pagereveal: PageRevealEvent;
	}

	interface NavigationActivation {
		entry: NavigationHistoryEntry;
		from: NavigationHistoryEntry;
		navigationType: NavigationTypeString;
	}
	interface AnimationEffect {
		target: HTMLElement;
		pseudoElement?: string;
		getKeyframes: () => Keyframe[];
	}

	interface ViewTransition {
		types: Set<string>;
	}
	interface Window {
		navigation: Navigation;
	}
	interface Navigation {
		activation: NavigationActivation;
	}
}
```

## Declarative Names

The `@vtbag/utensil-drawer/declarative-names` script assigns view transition names to HTML elements. This comes in handy if you want to assign names to many elements like all images in a container or all items in a list.

This is similar to
```css
selector {
  view-transition-name: auto;
}
```
but gives you more control over the assigned values. In particular, this is important for cross-document view transitions:

* Names generated with `view-transition-name: auto` on the old page will never match a name on the new page. All animations for generated names will either be exit or entry animations, but never morph animations.

* With the `declarative-names` script, you have the choice to use different prefixes for exit/entry animations or same prefixes for morph animations.

### Examples

This site uses the `declarative-names` script to make `h2` and `h3` headings standout when navigating through the pages. And to randomize the entries of table of contents visible in the right part of the screen in the desktop view. Here is the configuration used for this:

```awk
data-vtbag-decl=`
  :is(h2, h3):not(.no-vtbag-decl *) = vtbag-h-;
  :is(starlight-toc span):not(.no-vtbag-decl *) = vtbag-toc~`>
```
This assigns `vtbag-h-0, ...` to the h2 and h3 headers of every page, and `vtbag-toc-0, ...` to the entries of the page navigation bar. It looks a bit complicate due to the `:not` expressions that are used to hide some DOM subtrees from the script. A version without those much simpler:
```awk
data-vtbag-decl="h2, h3 = vtbag-h-;  starlight-toc span = vtbag-toc~"
```

Still looks cryptic? Let's decompose what it means:

### Configuration
You instruct the script with a `data-vtbag-decl` attribute on a script element. Typically on the very script element that loads the `declarative-names` code, but any other script element found in the DOM when the script executes will do. You can use this to your advantage to compose the declarations from multiple sources, but make sure that those elements a positioned before the `declarative-names` script.

#### Declarations
The syntax for the declaration is as follows:
<div style="width:fit-content; margin-inline: auto">
{/*<Media>
<p slot="caption">
```awk
data-vtbag-decl ::= ( rule ( ';' rule )* )? ;
           rule ::= css-selector ( '=' | '~=' ) prefix ;
```
</p>*/}
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 411 141" style="width: 500px">
   <defs>
      <style>{` .line                 {fill: none; stroke: #888888; stroke-width: 1;}
    polygon              {fill: #888888;}
    text.terminal         {font-family: Verdana, Sans-serif;
                            font-size: 12px;
                            fill: #141000;
                            font-weight: bold;
                          }
    text.nonterminal      {font-family: Verdana, Sans-serif;
                            font-size: 12px;
                            fill: #1A1400;
                            font-weight: normal;
                          }
    rect, circle, polygon {fill: #888888 stroke: #888888;}
    rect.terminal         {fill: #FFDB4D; stroke: #332900; stroke-width: 1;}
    rect.nonterminal      {fill: #FFEC9E; stroke: #332900; stroke-width: 1;}
  `}</style>
   </defs>
   <polygon points="9 61 1 57 1 65"/>
   <polygon points="17 61 9 57 9 65"/>
   <g>
      <rect x="71" y="47" width="96" height="32"/>
      <rect x="69" y="45" width="96" height="32" class="nonterminal"/>
      <text class="nonterminal" x="79" y="65">css-selector</text>
   </g>
   <rect x="207" y="47" width="30" height="32" rx="10"/>
   <rect x="205"
         y="45"
         width="30"
         height="32"
         class="terminal"
         rx="10"/>
   <text class="terminal" x="215" y="65">=</text>
   <rect x="207" y="91" width="40" height="32" rx="10"/>
   <rect x="205"
         y="89"
         width="40"
         height="32"
         class="terminal"
         rx="10"/>
   <text class="terminal" x="215" y="109">~=</text>
   <g>
      <rect x="287" y="47" width="56" height="32"/>
      <rect x="285" y="45" width="56" height="32" class="nonterminal"/>
      <text class="nonterminal" x="295" y="65">prefix</text>
   </g>
   <rect x="71" y="3" width="24" height="32" rx="10"/>
   <rect x="69"
         y="1"
         width="24"
         height="32"
         class="terminal"
         rx="10"/>
   <text class="terminal" x="79" y="21">;</text>
   <path class="line"
         d="m17 61 h2 m40 0 h10 m96 0 h10 m20 0 h10 m30 0 h10 m0 0 h10 m-80 0 h20 m60 0 h20 m-100 0 q10 0 10 10 m80 0 q0 -10 10 -10 m-90 10 v24 m80 0 v-24 m-80 24 q0 10 10 10 m60 0 q10 0 10 -10 m-70 10 h10 m40 0 h10 m20 -44 h10 m56 0 h10 m-312 0 l20 0 m-1 0 q-9 0 -9 -10 l0 -24 q0 -10 10 -10 m292 44 l20 0 m-20 0 q10 0 10 -10 l0 -24 q0 -10 -10 -10 m-292 0 h10 m24 0 h10 m0 0 h248 m-332 44 h20 m332 0 h20 m-372 0 q10 0 10 10 m352 0 q0 -10 10 -10 m-362 10 v58 m352 0 v-58 m-352 58 q0 10 10 10 m332 0 q10 0 10 -10 m-342 10 h10 m0 0 h322 m23 -78 h-3"/>
   <polygon points="401 61 409 57 409 65"/>
   <polygon points="401 61 393 57 393 65"/>
</svg>
{/*<Media>*/}
</div>

```awk
data-vtbag-decl ::= ( rule ( ';' rule )* )? ;
           rule ::= css-selector ( '=' | '~=' ) prefix ;
```
The data attribute accepts a semicolon separated list of rules.
A rule instructs the script to add a `view-transition-name` that starts with the string `prefix` to the `style` attribute of all DOM elements that are matched by the `css-selector`.

To ensure view transition names remain unique, a number starting at 0 and incremented by 1 is appended to the prefix for each rule. Numbers are assigned based on the order in which elements appear in the DOM, unless the prefix ends in `~`, in which case the `~` is replaced by `-` and the numbers are assigned in some random fashion. If an element's style attribute already includes a `view-transition-name`, it will be overridden, unless rule uses the weak assignment operator `~=`.


#### Script Usage
To ensure that the code is executed before the `pagereveal` event, the script must be placed inside the `<head>` element of your page as a classical inline script. Do _not_ add `type="module"` or the `defer` or `async` attributes as this would delay the script too much.

### Reusable Functions

See comments in `src/set-view-transition-names.ts`.